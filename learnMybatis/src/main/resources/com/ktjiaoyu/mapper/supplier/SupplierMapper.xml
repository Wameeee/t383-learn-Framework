<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktjiaoyu.mapper.supplier.SupplierMapper">
    <insert id="addSupplier" parameterType="supplier">
        INSERT INTO supplier (supCode, supName, supDesc, supContact, supPhone, supAddress, supFax, bizPicPath,
                              createdUserId, createdTime)
        VALUES (#{supCode}, #{supName}, #{supDesc}, #{supContact}, #{supPhone},
                #{supAddress}, #{supFax}, #{bizPicPath}, #{createdUserId}, #{createdTime})
    </insert>
    <update id="updateSupplierById" parameterType="supplier">
        UPDATE supplier
        SET supCode=#{supCode},
            supName=#{supName},
            supDesc=#{supDesc},
            supContact=#{supContact},
            supPhone=#{supPhone},
            supAddress=#{supAddress},
            supFax=#{supFax},
            bizPicPath=#{bizPicPath},
            updatedUserId=#{updatedUserId},
            updatedTime=#{updatedTime}
        WHERE id = #{id}
    </update>
    <delete id="deleteSupplierById" parameterType="supplier">
        DELETE
        FROM supplier
        WHERE id = #{id}
    </delete>

    <select id="getSupplierList" resultType="Supplier">
        SELECT *
        FROM supplier
    </select>
    <select id="count" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM supplier
    </select>
    <select id="getSupplierListAndStorageRecordListBySupId" resultMap="supplierListAndStorageRecordList">
        SELECT sl.id as sup_id,
               sl.supCode,
               sl.supName,
               sl.supContact,
               sl.supPhone,
               sr.id as sr_id,
               sr.srCode,
               sr.goodsName,
               sr.totalAmount,
               sr.payStatus
        FROM supplier sl,
             storage_record sr
        WHERE sl.id = #{id}
          AND sl.id = sr.supplierId
    </select>

    <resultMap id="supplierListAndStorageRecordList" type="Supplier">
        <id property="id" column="sup_id"/>
        <result property="supCode" column="supCode"/>
        <result property="supName" column="supName"/>
        <result property="supContact" column="supContact"/>
        <result property="supPhone" column="supPhone"/>
        <collection property="storageRecord" ofType="storageRecord">
            <id property="id" column="sr_id"/>
            <result property="srCode" column="srCode"/>
            <result property="goodsName" column="goodsName"/>
            <result property="totalAmount" column="totalAmount"/>
            <result property="payStatus" column="payStatus"/>
        </collection>
    </resultMap>
</mapper>